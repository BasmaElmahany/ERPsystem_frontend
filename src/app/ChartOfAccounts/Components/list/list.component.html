<div class="table-container" *ngIf="!loading; else loadingTpl">
  <div class="table-header">
    <h2>Chart of Accounts</h2>
    <span class="employee-count">{{ accounts.length }} Accounts</span>
     <button class="create-button" (click)="openCreateModal()">
        <i class="material-icons">add</i>
        New Account
      </button>
  </div>

  <div class="table-wrapper">
    <table class="styled-table">
      <thead>
        <tr>
          <th (click)="sortData('id')" class="sortable">
            ID
            <span class="sort-icon" *ngIf="sortKey === 'id'">
              {{ sortDirection === 'asc' ? '▲' : '▼' }}
            </span>
          </th>
          <th (click)="sortData('accountCode')" class="sortable">
            Code
            <span class="sort-icon" *ngIf="sortKey === 'accountCode'">
              {{ sortDirection === 'asc' ? '▲' : '▼' }}
            </span>
          </th>
          <th (click)="sortData('accountName')" class="sortable">
            Account Name
            <span class="sort-icon" *ngIf="sortKey === 'accountName'">
              {{ sortDirection === 'asc' ? '▲' : '▼' }}
            </span>
          </th>
          <th (click)="sortData('accountType')" class="sortable">
            Type
            <span class="sort-icon" *ngIf="sortKey === 'accountType'">
              {{ sortDirection === 'asc' ? '▲' : '▼' }}
            </span>
          </th>
          <th>Parent Account</th>
          <th>Is Detail</th>
          <th>Actions</th>
          
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let acc of accounts; let i = index" [style]="'--row-index: ' + i">
          <td class="id-cell">{{ acc.id }}</td>
          <td>{{ acc.accountCode }}</td>
          <td class="employee-name-cell">
            <div class="avatar">{{ acc.accountName.charAt(0) }}</div>
            {{ acc.accountName }}
          </td>
          <td>
            <span
              class="status-badge"
              [ngClass]="{
                'status-active': acc.accountType === 'Asset',
                'status-on-leave': acc.accountType === 'Expense',
                'status-terminated': acc.accountType === 'Liability'
              }"
            >
              {{ acc.accountType }}
            </span>
          </td>
          <td>{{ acc.parentAccountId || '—' }}</td>
          <td>
            <span
              class="status-badge"
              [ngClass]="{
                'status-active': acc.isDetail,
                'status-on-leave': !acc.isDetail
              }"
            >
              {{ acc.isDetail ? 'Yes' : 'No' }}
            </span>
          </td>
          <td class="actions-cell">
             <button class="action-button edit-button" (click)="openEditModal(acc)">
              <i class="material-icons">edit</i>
              
            </button>
               <button mat-icon-button color="warn" (click)="openDeleteModal(acc)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="table-footer">
    <p>Showing {{ accounts.length }} records from {{ projectName | titlecase }} project schema</p>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="table-container text-center">
    <mat-spinner diameter="48"></mat-spinner>
    <p>Loading chart of accounts...</p>
  </div>
</ng-template>
