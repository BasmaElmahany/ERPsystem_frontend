<div class ="home">
<div class="dashboard-container">
  <header class="dashboard-header">
    <img class="logo" [src]="logoPath" alt="logo" />
    <h1 class="page-title">Welcome to the ERP Dashboard</h1>
    <p class="subtitle">Real-time financial overview and project analytics.</p>
  </header>

  <div *ngIf="loadingProjects" class="loading-indicator">
    <p>Loading projects and financial summaries...</p>
    <div class="spinner"></div>
  </div>
  <div *ngIf="errorProjects" class="error-indicator">
    <p>Error loading projects. Please try again later.</p>
  </div>

  <!-- NEW: GLOBAL SUMMARY CARDS AT THE TOP -->
  <section class="section global-summary-cards" *ngIf="!loadingProjects && !errorProjects">
    <h2 class="section-title">Global Financial Summary</h2>
    <div class="summary-cards-container">
      <div class="summary-cards">
        <div class="card animated-card revenue-card">
          <h3>Total Revenue</h3>
          <p class="amount">{{ totalRevenue | currency:'USD':'symbol':'1.2-2' }}</p>
          <p class="muted">Across all projects</p>
        </div>
        <div class="card animated-card expense-card">
          <h3>Total Expenses</h3>
          <p class="amount">{{ totalExpenses | currency:'USD':'symbol':'1.2-2' }}</p>
          <p class="muted">Across all projects</p>
        </div>
        <div class="card animated-card net-card" [class.positive]="totalNetProfit >= 0"
          [class.negative]="totalNetProfit < 0">
          <h3>Net Profit</h3>
          <p class="amount">{{ totalNetProfit | currency:'USD':'symbol':'1.2-2' }}</p>
          <p class="muted">Global Summary</p>
        </div>
      </div>
    </div>
  </section>

  <!-- GLOBAL CHARTS -->
  <section class="section global-charts-section" *ngIf="!loadingProjects && !errorProjects">
    <h2 class="section-title">Global Charts</h2>
    <div class="global-charts-grid">
      <div class="global-charts">
        <div class="chart-card animated-card">
          <h4>Revenue vs Expenses</h4>
          <apx-chart *ngIf="globalBarChart" [series]="globalBarChart.series" [chart]="globalBarChart.chart"
            [xaxis]="globalBarChart.xaxis!" [plotOptions]="globalBarChart!.plotOptions!">
          </apx-chart>
        </div>

        <div class="chart-card animated-card">
          <h4>Distribution</h4>
          <apx-chart *ngIf="globalPieChart" [series]="globalPieChart.series" [chart]="globalPieChart.chart"
            [labels]="globalPieChart!.labels!">
          </apx-chart>
        </div>

        <div class="chart-card animated-card">
          <h4>Revenue / Expense per Project</h4>
          <apx-chart *ngIf="globalTrendChart" [series]="globalTrendChart.series" [chart]="globalTrendChart.chart"
            [xaxis]="globalTrendChart!.xaxis!">
          </apx-chart>
        </div>
      </div>
    </div>
  </section>

  <!-- PROJECTS LIST -->
  <section class="section projects-section" *ngIf="projects.length > 0">
    <h2 class="section-title">Project Details</h2>

    <div class="projects-grid">
      <div class="project-card animated-card" *ngFor="let project of projects">
        <div class="card-head" (click)="toggleProject(project)">
          <div class="left">
            <div class="card-icon"></div>
            <div>
              <h3 class="project-name">{{ project.name }}</h3>
              <p class="muted small">Net Profit:
                <span [class.positive]="getNetProfit(project) >= 0" [class.negative]="getNetProfit(project) < 0">
                  {{ getNetProfit(project) | currency:'USD':'symbol':'1.2-2' }}
                </span>
              </p>
            </div>
          </div>

          <div class="right">
            <p class="muted small">
              <span *ngIf="project.loadingReports">Loading...</span>
              <span *ngIf="project.errorReports" class="negative">Error</span>
              <span *ngIf="!project.loadingReports && !project.errorReports">
                Balanced: <strong [class.positive]="project.isBalanced" [class.negative]="!project.isBalanced">{{
                  project.isBalanced ? 'Yes' : 'No' }}</strong>
              </span>
            </p>
            <button class="toggle-btn">{{ project.expanded ? 'Hide' : 'Details' }}</button>
          </div>
        </div>

        <div class="card-body" [class.expanded]="project.expanded">
          <div class="charts-row">
            <div class="mini-chart">
              <h5>Revenue vs Expense</h5>
              <apx-chart *ngIf="project.barChart" [series]="project.barChart.series" [chart]="project.barChart.chart"
                [xaxis]="project.barChart.xaxis" [plotOptions]="project.barChart.plotOptions">
              </apx-chart>
            </div>

            <div class="mini-chart">
              <h5>Distribution</h5>
              <apx-chart *ngIf="project.pieChart" [series]="project.pieChart.series" [chart]="project.pieChart.chart"
                [labels]="project.pieChart.labels">
              </apx-chart>
            </div>

            <div class="mini-chart">
              <h5>Debit vs Credit</h5>
              <apx-chart *ngIf="project.balanceChart" [series]="project.balanceChart.series"
                [chart]="project.balanceChart.chart" [xaxis]="project.balanceChart.xaxis">
              </apx-chart>
            </div>
          </div>

          <div class="trial-balance-table-wrapper">
            <table class="trial-balance-table">
              <thead>
                <tr>
                  <th>Account</th>
                  <th>Type</th>
                  <th class="text-right">Debit</th>
                  <th class="text-right">Credit</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of project.trialBalance">
                  <td>{{ row.accountName }}</td>
                  <td>{{ row.accountType || '-' }}</td>
                  <td class="text-right">{{ row.debit | currency:'USD':'symbol':'1.2-2' }}</td>
                  <td class="text-right">{{ row.credit | currency:'USD':'symbol':'1.2-2' }}</td>
                </tr>
                <tr *ngIf="!project.trialBalance || project.trialBalance.length === 0">
                  <td colspan="4" class="text-center muted">No trial balance data</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- TRIAL BALANCE GLOBAL -->
  <section class="section trial-balance-section">
    <h2 class="section-title">Trial Balance Status (Global)</h2>

    <div class="balance-design-wrapper">
      <div class="balance-scale">
        <div class="scale-arm" [style.transform]="getScaleRotation()"></div>
        <div class="scale-base"></div>

        <div class="scale-pan left-pan">
          <div class="pan-label">Total Debits</div>
          <div class="pan-value value-debit">{{ globalTotalDebit | currency:'USD':'symbol':'1.0-0' }}</div>
        </div>

        <div class="scale-pan right-pan">
          <div class="pan-label">Total Credits</div>
          <div class="pan-value value-credit">{{ globalTotalCredit | currency:'USD':'symbol':'1.0-0' }}</div>
        </div>
      </div>

      <div class="balance-status-indicator">
        <div class="status-text">
          <span class="status-icon">
            <svg viewBox="0 0 24 24">
              <path d="M9 12l2 2 4-4" />
            </svg>
          </span>
          <span class="status-message" [class.balanced]="isBalanced()">
            {{ isBalanced() ? 'Trial Balance is Balanced' : 'Trial Balance Difference' }}
          </span>

        </div>
        <div class="balance-difference">Difference: {{ (globalTotalDebit - globalTotalCredit) |
          currency:'USD':'symbol':'1.2-2' }}</div>
      </div>
    </div>
  </section>
</div>

</div>