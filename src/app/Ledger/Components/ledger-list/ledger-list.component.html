<div class="container">

    <mat-tab-group (selectedTabChange)="onTabChange($event)">

        <!-- ================= TAB 1: Ledger Table ================= -->
        <mat-tab label="{{ 'GENERAL_LEDGER' | translate | async }}">

            <div class="table-container" *ngIf="!loading; else loadingTpl">

                <div class="table-header">
                    <h2>{{ 'GENERAL_LEDGER' | translate | async }}</h2>

                    <div class="header-actions">

                        <!-- ðŸ” Search -->
                        <input type="text" placeholder="{{ 'SEARCH_LEDGER_PLACEHOLDER' | translate | async }}" [(ngModel)]="searchTerm"
                            (input)="applySearch()" class="search-input" />

                        <!-- ðŸ—“ Date Range Filters -->
                        <div class="date-filters">
                            <input type="date" [(ngModel)]="startDate" (change)="applySearch()" class="date-input" />
                            <span class="date-separator">â€”</span>
                            <input type="date" [(ngModel)]="endDate" (change)="applySearch()" class="date-input" />
                        </div>

                        <button class="export-button" (click)="exportToExcel()">
                            <i class="material-icons">download</i>
                            {{ 'EXPORT_TO_EXCEL' | translate | async }}
                        </button>

                    </div>
                </div>

                <!-- TABLE -->
                <div class="table-wrapper">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th (click)="sortData('accountName')" class="sortable">
                                    {{ 'ACCOUNT_NAME' | translate | async }}
                                    <span *ngIf="sortKey === 'accountName'">
                                        {{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}
                                    </span>
                                </th>

                                <th (click)="sortData('accountType')" class="sortable">
                                    {{ 'TYPE' | translate | async }}
                                    <span *ngIf="sortKey === 'accountType'">
                                        {{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}
                                    </span>
                                </th>

                                <th (click)="sortData('description')" class="sortable">
                                    {{ 'DESCRIPTION' | translate | async }}
                                    <span *ngIf="sortKey === 'description'">
                                        {{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}
                                    </span>
                                </th>

                                <th (click)="sortData('debit')" class="sortable">
                                    {{ 'DEBIT' | translate | async }}
                                    <span *ngIf="sortKey === 'debit'">
                                        {{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}
                                    </span>
                                </th>

                                <th (click)="sortData('credit')" class="sortable">
                                    {{ 'CREDIT' | translate | async }}
                                    <span *ngIf="sortKey === 'credit'">
                                        {{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}
                                    </span>
                                </th>

                                <th (click)="sortData('balance')" class="sortable">
                                    {{ 'BALANCE' | translate | async }}
                                    <span *ngIf="sortKey === 'balance'">
                                        {{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}
                                    </span>
                                </th>

                                <th (click)="sortData('date')" class="sortable">
                                    {{ 'DATE' | translate | async }}
                                    <span *ngIf="sortKey === 'date'">
                                        {{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}
                                    </span>
                                </th>
                            </tr>
                        </thead>

                        <tbody>
                                <tr *ngFor="let j of paginatedledger; let i = index">
                                <td>{{ j.accountName }}</td>
                                <td>{{ translateAccountType(j.accountType) }}</td>
                                <td>{{ j.description }}</td>
                                <td>{{ j.debit }}</td>
                                <td>{{ j.credit }}</td>
                                <td>{{ j.balance }}</td>
                                <td>{{ formatDate(j.date) }}</td>
                            </tr>
                        </tbody>
                    </table>

                    <mat-paginator [length]="filteredledger.length" [pageSize]="pageSize"
                        [pageSizeOptions]="pageSizeOptions" [pageIndex]="pageIndex" (page)="onPageChange($event)"
                        aria-label="Select page">
                    </mat-paginator>

                </div>

                <div class="table-footer">
                    <p>
                        {{ 'SHOWING_LEDGER' | translate:{count: ledger.length, projectName: (projectName | titlecase)} | async }}
                    </p>
                </div>

            </div>

            <!-- Loading template -->
            <ng-template #loadingTpl>
                <div class="table-container text-center">
                    <mat-spinner diameter="48"></mat-spinner>
                    <p>{{ 'LOADING_LEDGER' | translate | async }}</p>
                </div>
            </ng-template>

        </mat-tab>

        <!-- ================= TAB 2: Charts ================= -->
        <mat-tab label="{{ 'TAB_CHARTS_SUMMARY' | translate | async }}">

            <div class="charts-tab-container">

                <div class="charts-grid">

                    <!-- Pie Chart -->
                    <div class="chart-card">
                        <apx-chart #pieChart [series]="pieChartOptions.series" [chart]="pieChartOptions.chart"
                            [labels]="pieChartOptions.labels" [dataLabels]="pieChartOptions.dataLabels"
                            [title]="pieChartOptions.title">
                        </apx-chart>
                    </div>

                    <!-- Bar Chart -->
                    <div class="chart-card">
                        <apx-chart #barChart [series]="barChartOptions.series" [chart]="barChartOptions.chart"
                            [xaxis]="barChartOptions.xaxis" [dataLabels]="barChartOptions.dataLabels"
                            [stroke]="barChartOptions.stroke" [markers]="barChartOptions.markers"
                            [title]="barChartOptions.title">
                            </apx-chart>
                    </div>

                </div>

            </div>

        </mat-tab>


    </mat-tab-group>

</div>